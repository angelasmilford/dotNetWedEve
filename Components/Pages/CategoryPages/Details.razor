@page "/categories/details"
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.QuickGrid

@using dotNetWedEve
@inject IDbContextFactory<dotNetWedEveContext> DbFactory
@inject NavigationManager NavigationManager

<PageTitle>Details</PageTitle>

<h1>Details</h1>

<div>
    <h2>Category</h2>
    <hr />
        <div style="display:grid; grid-template-columns: 1fr 3fr; grid-template-rows: 1fr 1fr;">
            <div style="grid-column: 1 / 1; grid-row: 1 / 1;">
                <div>Name</div>
                <div>@category.Name.</div>
            </div>
            <div style="grid-column: 1 / 1; grid-row: 2 / 2;">
                <div>
                <div>Color</div>
                    <div style="display:flex; align-items:center; gap:0.75rem;">
                        <div style="width:1.25rem; height:1.25rem; border:1px solid #ccc; background:@category.Color"></div>
                        <div>@category.Color</div>
                    </div>
                </div>
            </div>
            <div style="grid-column: 2 / 2; grid-row: 1 / span2; justify-self:right;">
                <div>Related Transactions</div>
                <div>
                    <QuickGrid Class="table" Items="@FilteredItems.Include(t => t.Category)" Pagination="@pagination">
                        <PropertyColumn Property="@(transaction => transaction.Name)" Sortable="true" IsDefaultSortColumn="true" />
                        <PropertyColumn Property="@(transaction => transaction.Date)" Sortable="true" Format="MM/dd/yyyy" />
                        <PropertyColumn Title="Amount" Property="@(transaction => (double)transaction.Amount)" Sortable="true" />
                    </QuickGrid>
                <Paginator State="@pagination" />
                </div>
            </div>
        </div>
        <div>
            <a href="@($"/categories/edit?id={category.Id}")">Edit</a> |
            <a href="@($"/categories")">Back to List</a>
        </div>

    
</div>

@code {
    private Category? category;
    private dotNetWedEveContext context = default!;

    PaginationState pagination = new PaginationState { ItemsPerPage = 5 };

    private IQueryable<Transaction> FilteredItems=> 
            context.Transaction.Where(m => m.Category.Id == Id);

    [SupplyParameterFromQuery]
    private int Id { get; set; }

    protected override void OnInitialized()
    {
        context = DbFactory.CreateDbContext();
        category = context.Category.FirstOrDefault(m => m.Id == Id);
    }

    public async ValueTask DisposeAsync() => await context.DisposeAsync();
}
